<!--
* (c) 2016 RedBus
*
* Name           : SPOCBusCancellationPage
* Created Date   : 10 Dec 2016
* Created By     : Sreenivas M
* Purpose        : VF page to display all Bus Cancellation cases to SPOC person for further processing.
*
-->

<apex:page standardController="Case" extensions="SPOCBusCancellationExtn" docType="html-5.0" id="pageId" showHeader="false" showChat="false" sidebar="false" lightningStylesheets="true">
<apex:slds />
<div class="slds-box slds-theme_default">
<div class="slds-scope">
<apex:includeScript value="//code.jquery.com/jquery-1.11.1.min.js"/>
<apex:includeScript value="/soap/ajax/45.0/connection.js"/>
<apex:includeScript value="/support/console/45.0/integration.js"/>
<apex:stylesheet value="{!$Resource.LoadingStatus}" />

    <apex:form id="formId" >
        <apex:inputHidden id="hidRouteId" value="{!routeIdtoRender}"/>
        <apex:inputHidden id="hidDropId" value="{!updateAction}"/>
        <apex:inputHidden id="hidCaseTabId" value="{!tableIdtoRender}"/>
        <apex:inputHidden id="hiddenHtmlDropId" value="{!hiddenHtmlDropId}"/>
        
        <apex:actionStatus id="statusSaveTrip">
            <apex:facet name="start">
                <div class="demo-only" style="height:6rem">
                    <div class="slds-spinner_container" style="position:fixed">
                        <div role="status" class="slds-spinner slds-spinner_large slds-spinner_brand">
                            <span class="slds-assistive-text">Loading</span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </div>
                </div>
            </apex:facet> 
        </apex:actionStatus>
        
        <apex:actionFunction name="updateRecords" action="{!performUpdate}" reRender="pgbId,slide,ccb,errMsg,spocErr" status="statusSaveTrip">
            <apex:param id="status" name="selStatus" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="boConnectCall" action="{!connectCall}" reRender="pgbId,errMsg,spocErr" status="statusSaveTrip"/>
        
        <apex:actionFunction name="jsLoadCasedata" action="{!loadCaseData}" reRender="pgbId,errMsg,spocErr" status="statusSaveTrip">
            <apex:param id="rid" name="selRouid" value=""/>
        </apex:actionFunction>
        
        <div class="slds-form">
            <div class="slds-section slds-is-open">
                <h3 class="slds-section__title slds-theme_shade" style="background-color:#f1e78d">
                    <span class="slds-truncate slds-p-horizontal_x-small " title="Section Title">Search Criteria</span>
                </h3>
                <div aria-hidden="false" class="slds-section__content">
                    <div class="slds-grid slds-wrap slds-grid_align-left slds-grid--align-spread">
                        <div class="slds-col slds-size--2-of-9 slds-medium-size--2-of-9">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="boNames">BO Name</label>
                                <div class="slds-form-element__control">
                                    <apex:selectList size="1" value="{!selBO}" id="boNames"><apex:selectOptions value="{!boOptions}"/></apex:selectList>
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--1-of-8 slds-medium-size--1-of-8">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="tin"> TIN</label>
                                <div class="slds-form-element__control">
                                    <apex:input type="text" id="tin" html-placeholder="TN/SG/MY/IDXX" styleClass="slds-input" value="{!tin}" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--1-of-11 slds-medium-size--1-of-11">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="doj"> Date Of Journey</label>
                                <div class="slds-form-element__control">
                                    <apex:input type="date" id="doj" styleClass="slds-input" value="{!doj}"/>
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--1-of-11 slds-medium-size--1-of-11">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="createdDate"> Date Of Creation</label>
                                <div class="slds-form-element__control">
                                    <apex:input type="date" id="createdDate" styleClass="slds-input" value="{!doi}" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--1-of-7 slds-medium-size--1-of-7 ">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="createdDate">Status</label>
                                <div class="slds-form-element__control">
                                    <apex:selectList size="1" value="{!selStatus}" id="st"><apex:selectOptions value="{!statusOptions}"/></apex:selectList>
                                    
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--2-of-9 slds-medium-size--2-of-9 slds-m-left_xx-large">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label" for="createdDate">Call Status</label>
                                <div class="slds-form-element__control">
                                    <apex:selectList value="{!callStatus}" multiselect="false" size="1">
                                        <apex:selectOption itemValue="" itemLabel="--None--"/>
                                        <apex:selectOption itemValue="BOs Called-Already" itemLabel="BOs Called-Already"/>
                                        <apex:selectOption itemValue="To-be-Called" itemLabel="To-be-Called"/>                        
                                    </apex:selectList>
                                </div>
                            </div>
                        </div>
                        
                        <div class="slds-col slds-size--1-of-9 slds-medium-size--1-of-9 slds-align_absolute-center">
                            <div class="slds-form-element slds-form-element">
                                <label class="slds-form-element__label"/>
                                <div class="slds-form-element__control">
                                    <apex:commandButton value="Search" action="{!doSearch}" reRender="resultPanel" status="statusSaveTrip" styleClass="slds-button slds-button_success"/>           
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
        <apex:pageBlock >
            
            <apex:outputPanel id="popup" styleClass="spocPopupPanel" style="display:none">            
                <apex:outputPanel styleClass="popupBackground" layout="block" />                      
                <apex:outputPanel styleClass="analysiSetPopupEmail" layout="block" >
                    <apex:pageMessages id="spocErr"></apex:pageMessages>
                    <apex:pageBlockSection title="SPOC Details" collapsible="false">
                        <apex:inputfield value="{!c.BOAgentNameBySPOC__c}" html-placeholder="Enter BO Agent Name" id="boName"/> 
                        <apex:inputfield value="{!c.BOAgentContactBySPOC__c}" html-placeholder="Enter BO Agent Phone Number" id="boPhone" onkeypress="return isNumber(event,'{!$Component.boPhone}')"/>
                        <apex:outputfield value="{!c.Approved_By__c}" />
                        <apex:outputpanel />
                        
                        <apex:commandButton value="Proceed" style="float:right;" styleClass="slds-button slds-button_success slds-m-left_small" onclick="proceedUpdate();return false;"/>  
                        <apex:commandButton value="Cancel" onclick="cancelUpdate();return false;" styleClass="slds-button slds-button_success"/>
                    </apex:pageBlockSection>
                </apex:outputPanel>
            </apex:outputPanel>
            
            <apex:outputPanel id="popup2" styleClass="spocPopupPanel2" style="display:none">      
                <apex:outputPanel styleClass="popupBackground" layout="block" /> 
                <apex:outputPanel styleClass="analysiSetPopupEmail" layout="block" >
                    <apex:pageblocksection >
                        Case Comment <apex:inputtextarea value="{!caseComment}" />
                        <apex:commandButton value="Save" style="float:right;" styleClass="slds-button slds-button_success slds-m-right_small" onclick="proceedUpdate();return false;"/>  
                        <apex:commandButton value="Cancel" onclick="cancelUpdate();return false;" styleClass="slds-button slds-button_success"/>
                        
                    </apex:pageblocksection>
                </apex:outputpanel>
                
            </apex:outputPanel>
            
            <apex:outputPanel id="popup3" styleClass="spocPopupPanel3" style="display:none">      
                <apex:outputPanel styleClass="popupBackground" layout="block" /> 
                <apex:outputPanel styleClass="analysiSetPopupEmail" layout="block" >
                    <apex:outputpanel >
                        
                        BO Phone Number &nbsp;&nbsp; <apex:inputtext value="{!boPhoneNo}"  onkeypress="return isNumber(event,'{!$Component.boPhone}')" id="boPhone"/>
                        &nbsp;&nbsp; &nbsp;&nbsp;
                        <apex:actionStatus id="loadStatus" >
                            <apex:facet name="start" >
                                <apex:commandButton value="Calling..." style="height:30px;width:150px;font-size:15px;background:#04844b;color:white;font-family:Arial;"  disabled="true" status="loadStatus"/>                                       
                            </apex:facet>
                            <apex:facet name="stop">
                                <apex:commandButton value="Call" style="width:100px" styleClass="slds-button slds-button_success slds-m-right_small" action="{!connectCall}" reRender="pgbId,errMsg,spocErr"  status="loadStatus"/>
                            </apex:facet>
                        </apex:actionStatus>
                        
                        <apex:commandButton value="Cancel" onclick="cancelUpdate();return false;" style="width:100px;" styleClass="slds-button slds-button_success" />
                    </apex:outputpanel>
                    
                </apex:outputpanel>   
            </apex:outputPanel>
            
            <apex:outputPanel id="slide">
                <script>
                
                if('{!reEnablePopup}' == 'true')
                {
                    $('.spocPopupPanel').show();
                }
                
                else
                {
                    $('.spocPopupPanel').hide();
                }
                </script>
            </apex:outputPanel>
            
            <apex:outputPanel id="ccb">
                <script>
            
                if('{!reEnableCCPopup}' == 'true')
                {
                    $('.spocPopupPanel2').show();
                }
                
                else
                {
                    $('.spocPopupPanel2').hide();
                }
                
                
                </script>
            </apex:outputPanel>
            
            <apex:outputPanel id="bop">
                <script>
            
                if('{!reEnableBOPopup}' == 'true')
                {
                    $('.spocPopupPanel3').show();
                }
                
                else
                {
                    $('.spocPopupPanel3').hide();
                }
                
                
                </script>
            </apex:outputPanel>
            
            <apex:outputPanel id="resultPanel">
                <input type="hidden" id="hiddenSelStas"/>
                <input type="hidden" id="hiddenHtmlDropId"/>
                <input type="hidden" id="hiddenTinStatus4"/>
                
                <script>
                
                if('{!reEnablePopup}' == 'true')
                {
                    $('.spocPopupPanel').show();
                }
                else
                {
                    $('.spocPopupPanel').hide();
                }
                
                document.getElementById('hiddenSelStas').value ='{!selStatus}';
                document.getElementById('hiddenTinStatus4').value ='{!tinStatus}';
                toggleChildRow('routeTableRB','routeTableRB');
                </script>
                
             <!--  <apex:pageBlockSection columns="1" title="Search Result" rendered="{!showSearchResult}">  -->
                <div class="slds-section slds-is-open" style="{!IF(showSearchResult,'display:block','display:none')}">
                <h3 class="slds-section__title slds-theme_shade" style="background-color:#f1e78d">
                    <span class="slds-truncate slds-p-horizontal_x-small " title="Section Result">Search Result</span>
                </h3>
                <div aria-hidden="false" class="slds-section__content">
                    <apex:outputPanel id="accountTableData" layout="block" >
                        <apex:pageMessages id="errMsg"></apex:pageMessages>
                        
                        <table id="ServcTableid" class="table" align="center" cellspacing="0" width="100%">
                            <thead>
                                <tr><th colspan="8"></th></tr>
                            </thead>
                            
                            <tbody><!--mapServiceIdtoCase-->
                                <apex:repeat value="{!mapServiceIdtoCase}" var="srvc">
                                    <tr><!-- <script>alert('data fetch inside');</script> -->
<td colspan="8">                         
<B><apex:outputLink value="javascript:void(0)" styleClass="routeTable{!srvc}" onclick="toggleChildRow('routeTable{!srvc}','routeTable{!srvc}')">(+)  </apex:outputLink>Service Id: &nbsp;<font color="mediumvioletred">{!srvc}</font>
                                                                                                                                                 </B></td>
                                                                                                                                                 
                                                                                                                                                 </tr>
                                                                                                                                                 <tr>
                                                                                                                                                 <td colspan="8" class="routeTableClass" id="routeTable{!srvc}">
                                                                                                                                                 <apex:outputPanel id="panelId">  
                                                                                                                                                 <table id="ownTable" class="slds-table slds-table_cell-buffer" align="center" cellspacing="0" width="100%">
                                                                                                                                                 
                                                                                                                                                 <tbody>
                                                                                                                                                 <apex:repeat value="{!mapServiceIdtoRouteId[srvc]}" var="route">
                                                                                                                                                 <tr>
                                                                                                                                                 <td colspan="4">                         
                                                                                                                                                 <apex:outputLink value="javascript:void(0)" styleClass="caseTable{!srvc}{!route}" onclick="toggleChildRow('caseTable{!srvc}{!route}','caseTable{!srvc}{!route}{!srvc}')" >(+)  </apex:outputLink><font color="blue">Route Id : {!route}</font>
    </td>



<td colspan="1">
    <apex:outputPanel style="float:right;display:none;" styleClass="button{!srvc}{!route}">
        Status <select id="caseTable{!srvc}{!route}{!srvc}"> </select>
        </apex:outputPanel>
        </td>
        <td colspan="1">
            <apex:outputPanel style="float:left;display:none;" styleClass="button{!srvc}{!route}">
                <apex:commandButton value="Update" onclick="updateSelRecords('caseTable{!srvc}{!route}','caseTable{!srvc}{!route}{!srvc}','routeTable{!srvc}');return false;" styleClass="slds-button slds-button_success"/>
                    </apex:outputpanel>
                </td>                                            
                </tr>
                
                <tr>
                    <td colspan="8" class="childTableClass" id="caseTable{!srvc}{!route}" style="padding:0">
                        <apex:outputPanel id="pgbId" rendered="{!showSearchResult}" layout="block" style="overflow:scroll;overflow-y: hidden;">
                            
                            <table class="caseTable{!srvc}{!route}" style="width: 150%;">
                                
                                <thead>
                                <tr class="slds-line-height_reset">
                                    <th class="colWidthStyle" scope="col">
                                        <div class="slds-truncate">
                                            <input type="checkbox" onclick="selectAllCheckboxes(this,'{!srvc}{!route}chbxId')" title="Select All"/>
                                                </div>
                                            </th>
                                            <th class="colWidthStyle" scope="col">
                                                <div class="slds-truncate" title="Call"/>
                                                    </th>
                                                <th class="" scope="col" style="width:85px">
                                                    <div class="slds-truncate" title="Case Id">Case Id</div>
                                                    </th>
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Creation Time">Creation Time</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Trip Id">Trip Id</div>
                                                            </th>
                                                            <th class="" scope="col">
                                                                <div class="slds-truncate" title="Status">Status</div>
                                                                </th>
                                                                <th class="" scope="col">
                                                                    <div class="slds-truncate" title="Notes">Notes</div>
                                                                    </th>
                                                                    <th class="" scope="col">
                                                                        <div class="slds-truncate" title="Transaction">Transaction#</div>
                                                                        </th>
                                                                        <th class="" scope="col">
                                                                            <div class="slds-truncate" title="TIN">TIN</div>
                                                                            </th>
                                                                            <th class="" scope="col">
                                                                                <div class="slds-truncate" title="DOJ">DOJ</div>
                                                                                </th>
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Customer Name">Customer Name
                                                                                    </div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="PNR">PNR</div>
                                                                                        </th>
                                                                                        <th class="" scope="col">
                                                                                            <div class="slds-truncate" title="Seats">Seats</div>
                                                                                            </th>
                                                                                            <th class="" scope="col">
                                                                                                <div class="slds-truncate" title="BO NAME">Bo Name</div>
                                                                                                </th>
                                                                                                <th class="" scope="col">
                                                                                                    <div class="slds-truncate" title="IS PRIMARY">Is Primary</div>
                                                                                                    </th>
                                                                                                    <th class="" scope="col">
                                                                                                        <div class="slds-truncate" title="BO Id">BO Id</div>
                                                                                                        </th>
                                                                                                        <th class="" scope="col">
                                                                                                            <div class="slds-truncate" title="Source">Source</div>
                                                                                                            </th>
                                                                                                            <th class="" scope="col">
                                                                                                                <div class="slds-truncate" title="Modified By">Modified By</div>
                                                                                                                </th>
                                                                                                                </tr>
                                                                                                                </thead>
                                                                                                                <tbody>
                                                                                                                    <apex:repeat value="{!listWrapCase}" var="caseWrap" rows="5">       
                                                                                                                        <tr class="slds-hint-parent">                                            
                                                                                                                            
                                                                                                                            <td>
                                                                                                                            <div class="slds-truncate sldswordWrap" title="Select" style="margin-left: 24px">
                                                                                                                                <apex:inputCheckbox value="{!caseWrap.isSelect}" styleClass="{!srvc}{!route}chbxId" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                    </div>
                                                                                                                                </td>
                                                                                                                                <td>
                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Is_Primary__c}" onclick="BOCall('caseTable{!srvc}{!route}','caseTable{!srvc}{!route}{!srvc}','routeTable{!srvc}');return false;" style="{!IF(AND(caseWrap.routeId==route,caseWrap.servcId ==srvc),'display:block','display:none')}">
                                                                                                                                        <span class="slds-icon_container slds-icon-standard-call" title="Dial To Bo" style="height:40px;width:40px">
                                                                                                                                            <span style="{!IF(caseWrap.callsCount==null,'display: inline-grid;width:35px;text-align:end;','display:none')}"> #{!caseWrap.callsCount}</span>

                                                                                                                                            <svg class="slds-icon" aria-hidden="true">                                                                            
                                                                                                                                                <use xmlns:xlink="http://www.w3.org/1777/xlink" xlink:href="/apexpages/slds/latest/assets/icons/standard-sprite/svg/symbols.svg#call" />
                                                                                                                                             </svg>
                                                                                                                                                <span class="slds-assistive-text">Description of icon when needed</span>
                                                                                                                                                </span>
                                                                                                                                                </div>
                                                                                                                                                </td>
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                <th scope="row">
                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.CaseNumber}">
                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.CaseNumber}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}" styleClass="slds-text-link" onClick="openCaseSubtab('{!caseWrap.cs.id}','{!caseWrap.cs.CaseNumber}');return false;"/>
                                                                                                                                                            
                                                                                                                                                            </div>
                                                                                                                                                        </th>
                                                                                                                                                        
                                                                                                                                                        <td data-label="{!caseWrap.createddate}">
                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.createddate}">
                                                                                                                                                                <apex:outputLabel value="{!caseWrap.createddate}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                    </div>
                                                                                                                                                                </td>
                                                                                                                                                                
                                                                                                                                                                <td data-label="{!caseWrap.cs.Trip_ID__c}">
                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Trip_ID__c}">
                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Trip_ID__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                            </div>
                                                                                                                                                                        </td>
                                                                                                                                                                        
                                                                                                                                                                        <td data-label="{!caseWrap.cs.status}">
                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.status}">
                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.status}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                    </div>
                                                                                                                                                                                </td>
                                                                                                                                                                                
                                                                                                                                                                                <td data-label="{!caseWrap.cs.Notes__c}">
                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Notes__c}">
                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Notes__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                            </div>
                                                                                                                                                                                        </td>
                                                                                                                                                                                        
                                                                                                                                                                                        <td data-label="{!caseWrap.cs.Transaction_ID__r.name}">
                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Transaction_ID__r.name}">
                                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.Transaction_ID__r.name}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}" styleClass="slds-text-link" onClick="openCaseSubtab('{!caseWrap.cs.Transaction_ID__c}','{!caseWrap.cs.Transaction_ID__r.Name}');return false;"/>
                                                                                                                                                                                                    </div>
                                                                                                                                                                                                </td>
                                                                                                                                                                                                
                                                                                                                                                                                                <td data-label="{!caseWrap.cs.TIN__c}">
                                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.TIN__c}">
                                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.TIN__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                            </div>
                                                                                                                                                                                                        </td>
                                                                                                                                                                                                        
                                                                                                                                                                                                        <td data-label="{!caseWrap.cs.Date_Of_Journey_New__c}">
                                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Date_Of_Journey_New__c}">
                                                                                                                                                                                                                <apex:outputfield value=" {!caseWrap.cs.Date_Of_Journey_New__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                <td data-label="{!caseWrap.cs.Customer_Name__r.name}">
                                                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Customer_Name__r.name}">
                                                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Customer_Name__r.name}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                        </td>
                                                                                                                                                                                                                        <td data-label="{!caseWrap.cs.PNR_No__c}">
                                                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.PNR_No__c}">
                                                                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.PNR_No__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                <td data-label="{!caseWrap.cs.Seats__c}">
                                                                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Seats__c}">
                                                                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Seats__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                        </td>
                                                                                                                                                                                                                                        <td data-label="{!caseWrap.cs.Bus_Operator_Name__c}">
                                                                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Bus_Operator_Name__c}">
                                                                                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.Bus_Operator_Name__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                                <td data-label="{!caseWrap.cs.Is_Primary__c}">
                                                                                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Is_Primary__c}">
                                                                                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Is_Primary__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                        </td>  
                                                                                                                                                                                                                                                        <td data-label="{!caseWrap.cs.Service_Provider_Id__c}">
                                                                                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Service_Provider_Id__c}">
                                                                                                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.Service_Provider_Id__c}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                                                <td data-label="{!caseWrap.cs.Origin}">
                                                                                                                                                                                                                                                                    <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.Origin}">
                                                                                                                                                                                                                                                                        <apex:outputLabel value="{!caseWrap.cs.Origin}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                        </td>
                                                                                                                                                                                                                                                                        <td data-label="{!caseWrap.cs.lastmodifiedby.name}">
                                                                                                                                                                                                                                                                            <div class="slds-truncate sldswordWrap" title="{!caseWrap.cs.lastmodifiedby.name}">
                                                                                                                                                                                                                                                                                <apex:outputLabel value="{!caseWrap.cs.lastmodifiedby.name}" rendered="{!AND(caseWrap.routeId==route,caseWrap.servcId ==srvc)}"/>
                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                </tr>
                                                                                                                                                                                                                                                                                </apex:repeat>
                                                                                                                                                                                                                                                                                </tbody>
                                                                                                                                                                                                                                                                                </table>                                                 
                                                                                                                                                                                                                                                                                </apex:outputPanel>
                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                                                                                                                                                                    </tr> 
                                                                                                                                                                                                                                                                                                                                                                                    </apex:repeat>
                                                                                                                                                                                                                                                                                                                                                                                    </tbody>
                                                                                                                                                                                                                                                                                                                                                                                    </table>
                                                                                                                                                                                                                                                                                                                                                                                    </apex:outputPanel>      
                                                                                                                                                                                                                                                                                                                                                                                    </td>
                                                                                                                                                                                                                                                                                                                                                                                    </tr>
                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                    </apex:repeat>
                                                                                                                                                                                                                                                                                                                                                                                    </tbody>
                                                                                                                                                                                                                                                                                                                                                                                    </table>
                                                                                                                                                                                                                                                                                                                                                                                    <apex:outputPanel >
                                                                                                                                                                                                                                                                                                                                                                                        <center><apex:outputText rendered="{!noResultfound}"> <font style="background-color: hotpink;"><B>No records found for the search criteria </b></font></apex:outputText></center>
                                                                                                                                                                                                                                                                                                                                                                                            </apex:outputPanel>
                                                                                                                                                                                                                                                                                                                                                                                            </apex:outputPanel>
                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                     </div>                      <!--      </apex:pageBlockSection> --> 
<script>
if('{!tableIdtoRender}')
{
var hidDropId = document.getElementById("pageId:formId:hiddenHtmlDropId").value;
}
</script>
</apex:outputPanel>
</apex:pageBlock>
</apex:form>
<style>
td.childTableClass {
display: none;
}

td.routeTableClass{
display: none;
}

table.table td{
padding: 0 !important;
line-height: 22px;
}
table.table{
width: 100% !important;
}

table.table {
border: 1px solid black;
border-bottom: 1px solid black
border-collapse: collapse;
}

.sldswordWrap{
word-break: break-word !important;
text-overflow: unset !important;
white-space: pre-wrap !important;
}
.colWidthStyle
{
width:50px !important;
}
</style>

<script type="text/javascript">  

function openCaseSubtab(recId,recName) {
        
        if (sforce.console.isInConsole()) 
          {
            sforce.console.getEnclosingPrimaryTabId(function(result)
            {
             
              sforce.console.openPrimaryTab(undefined,'/'+recId, true,recName);
             
            });
          } 
          else
            {
            
                if (UITheme.getUITheme() === 'Theme4d' || UITheme.getUITheme() === 'Theme4u')                  
                     sforce.one.navigateToSObject(recId,'detail');
                else 
                    window.open('/' + recId);
            }
    }

function selectAllCheckboxes(obj,receivedInputID){
var that=obj;
$('.'+receivedInputID).each(function(){      
    
    this.checked=that.checked;  
    
});
}
function BOCall2(tc,dropId,rouId)
{

var chbxClass = '.'+tc.replace("caseTable","")+'chbxId';           
if($(chbxClass).is(':checked')){
    $('.spocPopupPanel3').show();
}

else
{
    alert('Please select at least one record');
    return false;
}

} 

function BOCall(tc,dropId,rouId)
{
var chbxClass = '.'+tc.replace("caseTable","")+'chbxId';           
/* if($(chbxClass).is(':checked')){
        $('.spocPopupPanel3').show();
    }*/


if($(chbxClass+':checked').length=="1"){
    $('.spocPopupPanel3').show();
} else if($(chbxClass+':checked').length=="0"){
    alert('Please select at least one record');
    return false;
}else if ($(chbxClass+':checked').length == $(chbxClass).length  ) {                             
    alert('Please select only one record');
    return false            
}

} 

function updateSelRecords(tc,dropId,rouId)
{

var chbxClass = '.'+tc.replace("caseTable","")+'chbxId';           
if($(chbxClass).is(':checked')){}

else
{
    alert('Please select at least one record');
    return false;
}


var selAction = document.getElementById(dropId).value;

if(selAction=='-None-')
{
    alert('Please select the action');
    return false;
}

if ($(chbxClass+':checked').length == $(chbxClass).length) 
{
    
    if(confirm('You have selected all records for ' +selAction +' action. Are you sure?')){}
    
    else
        return false;      
}


document.getElementById("pageId:formId:hidRouteId").value = rouId;
document.getElementById("pageId:formId:hidCaseTabId").value = tc;
document.getElementById("pageId:formId:hiddenHtmlDropId").value = dropId;        
document.getElementById("pageId:formId:hidDropId").value = selAction;

if(selAction === 'Approved' || selAction === 'Rejected' || selAction == 'COUNTER' || selAction == "WEBSITE CANCEL")
{
    $('.spocPopupPanel').show();
    window.scrollTo(0, 0);
}
else if(selAction ==='Refunded by BO' ||selAction ==='Refunded by redBus' ||selAction ==='Alternative Arrangement by redBus' ||selAction ==='Alternative Arrangement by BO'){
    $('.spocPopupPanel2').show();
    window.scrollTo(0, 0);
    
}                   
    else
        updateRecords('Dummy'); 
}

function proceedUpdate()
{
updateRecords('Dummy');
}

function proceedBOCall()
{
boConnectCall('');
}

function cancelUpdate()
{
$('.spocPopupPanel').hide();
$('.spocPopupPanel2').hide();
$('.spocPopupPanel3').hide();
}


function isNumber(evt,phId) {
evt = (evt) ? evt : window.event;
var charCode = (evt.which) ? evt.which : evt.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57)) {
    return false;
}
else
{
    if( document.getElementById(phId).value.length<10)
        return true;
    else
        return false;
    
}
}



function toggleChildRow(recordID,dropDownId){

var boStatus =document.getElementById('hiddenSelStas').value;
var tinStatus =document.getElementById('hiddenTinStatus4').value;



if(((tinStatus !='') || (boStatus!='All' && boStatus!='Alternative Arrangement by BO' && boStatus!='Refund by redBus' && boStatus!='Refund by BO' )) && recordID.includes("caseTable"))
{
    
    var buttonClass = "."+recordID.replace("caseTable","button");
    var dropId = "#"+dropDownId;
    console.log('buttonClass..'+buttonClass);          
    
    
    if((boStatus==='Initiated' && dropId!='#') || (tinStatus==='Initiated'))
    {
        
        $(dropId).find('option').remove().end().append('<option value="-None-">--None--</option>','<option value="Approved">Approved for Bus Cancellation</option>','<option value="Rejected">Rejected for Bus Cancellation</option>','<option value="RTC COUNTER">Diverted Customer to Counter</option>','<option value="WEBSITE CANCEL">Diverted Customer to Cancel on Website</option>');
        $(buttonClass).toggle();
        
    }
    
    if((boStatus==='Approved For Bus Cancellation' && dropId!='#')|| (tinStatus==='Approved For Bus Cancellation'))
    {
        $(dropId).find('option').remove().end().append('<option value="-None-">--None--</option>','<option value="Refunded by BO">Refunded by BO</option>','<option value="Refunded by redBus">Refunded by redBus</option>','<option value="Alternative Arrangement by redBus">Alternative Arrangement by redBus</option>','<option value="Alternative Arrangement by BO">Alternative Arrangement by BO</option>');
        $(buttonClass).toggle();
    }
    if((boStatus==='Rejected For Bus Cancellation' && dropId!='#') || tinStatus ==='Rejected For Bus Cancellation')
    {
        $(dropId).find('option').remove().end().append('<option value="-None-">--None--</option>','<option value="Re-Approved">Re-Approved for Bus Cancellation</option>');
        $(buttonClass).toggle();
    }
}


var findClass = "."+recordID;         
recordID = "#"+recordID;

$( recordID ).toggle(function()
                     {
                         
                         var $varText = $(this).closest("tbody").find(findClass);
                         
                         if($varText.text().indexOf("+") > -1){
                             $varText.html("(-)");
                             
                             if(recordID.includes("caseTable"))
                             {
                                 console.log('caseTable 2..>');
                                 document.getElementById("pageId:formId:hidCaseTabId").value = recordID.replace("#","");
                                 console.log('Datalog call..'+recordID);
                                 jsLoadCasedata(recordID.replace("#caseTableRB",""));
                                 
                             }
                         }
                         else{
                             $varText.html("(+)");
                         }
                     });
}

</script>
</div></div>
</apex:page>